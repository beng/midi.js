(function(e){var t,n,r;(function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(t){if(d(f,t)){var n=f[t];delete f[t],c[t]=!0,i.apply(e,n)}if(!d(a,t)&&!d(c,t))throw new Error("No "+t);return a[t]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(t,n,r,i){var s,l,h,p,v,g=[],w;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")s=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=r.apply(a[t],g);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=r)},t=n=s=function(t,n,r,a,f){return typeof t=="string"?u[t]?u[t](n):b(o(t,n).f):(t.splice||(l=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},typeof r=="function"&&(r=a,a=f),a?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},r=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},r.amd={jQuery:!0}})(),r("almond",function(){}),r("lib/stream",[],function(){var e;return e=function(){function e(e){this.str=e,this.position=0}return e.prototype.read=function(e){var t;return t=this.str.substr(this.position,e),this.position+=e,t},e.prototype.readInt32=function(){var e,t,n;return n=this.str,e=this.position,t=(n.charCodeAt(e)<<24)+(n.charCodeAt(e+1)<<16)+(n.charCodeAt(e+2)<<8)+n.charCodeAt(e+3),this.position+=4,t},e.prototype.readInt16=function(){var e,t,n;return n=this.str,e=this.position,t=(n.charCodeAt(e)<<8)+n.charCodeAt(e+1),this.position+=2,t},e.prototype.readInt8=function(e){var t;return t=this.str.charCodeAt(this.position),e&&t>127&&(t-=256),this.position+=1,t},e.prototype.eof=function(){return this.position>=this.str.length},e.prototype.readVarInt=function(){var e,t;t=0;for(;;){e=this.readInt8();if(!(e&128))return t+e;t+=e&127,t<<=7}},e.prototype.readChunk=function(){var e,t,n;return t=this.read(4),n=this.readInt32(),e=this.read(n),{id:t,length:n,data:e}},e}()}),r("lib/events",[],function(){return{SequenceNumber:function(e,t){return this.type="meta",this.name="sequenceNumber",this.number=e,this.time=t||0},Text:function(e,t){return this.type="meta",this.name="text",this.text=e,this.time=t||0},CopyrightNotice:function(e,t){return this.type="meta",this.name="copyrightNotice",this.text=e,this.time=t||0},TrackName:function(e,t){return this.type="meta",this.name="trackName",this.text=e,this.time=t||0},InstrumentName:function(e,t){return this.type="meta",this.name="instrumentName",this.text=e,this.time=t||0},Lyrics:function(e,t){return this.name="lyrics",this.text=e,this.time=t||0},Marker:function(e,t){return this.type="meta",this.name="marker",this.text=e,this.time=t||0},CuePoint:function(e,t){return this.type="meta",this.name="cuePoint",this.text=e,this.time=t||0},ChannelPrefix:function(e,t){return this.type="meta",this.name="channelPrefix",this.channel=e,this.time=t||0},EndOfTrack:function(e){return this.type="meta",this.name="endOfTrack",this.time=e||0},SetTempo:function(e,t){return this.type="meta",this.name="setTempo",this.microseconds=e,this.time=t||0},SMPTEOffset:function(e,t,n,r,i,s,o){return this.type="meta",this.name="smpteOffset",this.frameRate=e,this.hour=t,this.min=n,this.sec=r,this.frame=i,this.subframe=s,this.time=o||0},TimeSignature:function(e,t,n,r,i){return this.type="meta",this.name="timeSignature",this.numerator=e,this.denominator=t,this.metronome=n,this.thirtyseconds=r,this.time=i||0},KeySignature:function(e,t,n){return this.type="meta",this.name="keySignature",this.key=e,this.scale=t,this.time=n||0},SequencerSpecific:function(e,t){return this.type="meta",this.name="sequencerSpecific",this.data=e,this.time=t||0},NoteOn:function(e,t,n){return this.type="channel",this.name="noteOn",this.number=e,this.velocity=t,this.time=n||0},NoteOff:function(e,t,n){return this.type="channel",this.name="noteOff",this.number=e,this.velocity=t,this.time=n||0},NoteAftertouch:function(e,t,n){return this.type="channel",this.name="noteAftertouch",this.number=e,this.amount=t,this.time=n||0},Controller:function(e,t,n){return this.type="channel",this.name="controller",this.controller=e,this.value=t,this.time=n||0},ProgramChange:function(e,t){return this.type="channel",this.name="programChange",this.number=e,this.time=t||0},ChannelAftertouch:function(e,t){return this.type="channel",this.name="channelAftertouch",this.amount=e,this.time=t||0},PitchBend:function(e,t){return this.type="channel",this.controller=controller,this.value=e,this.time=t||0}}});var i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r("lib/parser",["./stream","./events"],function(e,t){var n,r,i,o,u,a,f,l,c,h;return r=function(){function e(){}return e.checkLength=function(e,t,n){if(t!==n)throw"Expected length for "+e+" event is "+n+", got "+t;if(t===n)return!0},e}(),a=function(e){function t(){return l=t.__super__.constructor.apply(this,arguments),l}return s(t,e),t.events={0:function(e,n,r){if(!t.checkLength("SequenceNumber",e,2))return;return new MIDI.Events.SequenceNumber(n.readInt16(),r)},1:function(e,t,n){return new MIDI.Events.Text(t.read(e),n)},2:function(e,t,n){return new MIDI.Events.CopyrightNotice(t.read(e),n)},3:function(e,t,n){return new MIDI.Events.TrackName(t.read(e),n)},4:function(e,t,n){return new MIDI.Events.InstrumentName(t.read(e),n)},5:function(e,t,n){return new MIDI.Events.Lyrics(t.read(e),n)},6:function(e,t,n){return new MIDI.Events.Marker(t.read(e),n)},7:function(e,t,n){return new MIDI.Events.CuePoint(t.read(e),n)},32:function(e,n,r){if(!t.checkLength("ChannelPrefix",e,1))return;return new MIDI.Events.ChannelPrefix(n.readInt8(),r)},47:function(e,n,r){if(!t.checkLength("EndOfTrack",e,0))return;return new MIDI.Events.EndOfTrack(r)},81:function(e,n,r){if(!t.checkLength("SetTempo",e,3))return;return new MIDI.Events.SetTempo((n.readInt8()<<16)+(n.readInt8()<<8)+n.readInt8(),r)},84:function(e,n,r){var i,s;if(!t.checkLength("SMPTEOffset",e,5))return;return s=n.readInt8(),i={0:24,32:25,64:29,96:30},i=i[s&96],new SMPTEOffset(i,s&31,n.readInt8(),n.readInt8(),n.readInt8(),n.readInt8(),r)},88:function(e,n,r){if(!t.checkLength("TimeSignature",e,4))return;return new MIDI.Events.TimeSignature(n.readInt8(),Math.pow(2,n.readInt8()),n.readInt8(),n.readInt8(),r)},89:function(e,n,r){if(!t.checkLength("KeySignature",e,2))return;return new MIDI.Events.KeySignature(n.readInt8(!0),n.readInt8(),r)},127:function(e,t,n){return new MIDI.Events.SequencerSpecific(t.read(e),n)}},t.prototype.read=function(e,n,r){var i,s,o;return o=e.readInt8(),s=e.readVarInt(),i=t.events[o],i?i(s,e,n):{type:"unknown",time:n,data:e.read(s)}},t}(r),n=function(e){function t(){return c=t.__super__.constructor.apply(this,arguments),c}return s(t,e),t.events={8:function(e,t,n){return new MIDI.Events.NoteOff(e,t.readInt8(),n)},9:function(e,t,n){var r,i;return i=t.readInt8(),r=i?"NoteOn":"NoteOff",new MIDI.Events[r](e,i,n)},10:function(e,t,n){return new MIDI.Events.NoteAftertouch(e,t.readInt8(),n)},11:function(e,t,n){return new MIDI.Events.Controller(e,t.readInt8(),n)},12:function(e,t,n){return new MIDI.Events.ProgramChange(e,n)},13:function(e,t,n){return new MIDI.Events.ChannelAftertouch(e,n)},14:function(e,t,n){return new MIDI.Events.PitchBend(e+(t.readInt8()<<7),n)}},t.prototype.read=function(e,n,r){var i,s,o,u;return(r&128)===0?(u=r,r=this._lastEventTypeByte):(u=e.readInt8(),this._lastEventTypeByte=r),o=r>>4,i=r&15,s=t.events[o],s?s(u,e,n):{type:"unknown",time:n,channel:i}},t}(r),f=function(e){function t(){return h=t.__super__.constructor.apply(this,arguments),h}return s(t,e),t.events={240:function(e,t){var n;return n=e.readVarInt(),new MIDI.Events.SysEx(e.read(n),t)},247:function(e,t){var n;return n=e.readVarInt(),new MIDI.Events.DividedSysEx(e.read(n),t)}},t.prototype.read=function(e,n,r){var i;return i=t.events[r],i?i(e,n):{type:"unknown",time:n}},t}(r),i=function(){function t(e){this.midi_stream=e}return t.prototype.read=function(){var t,n,r;n=this.midi_stream.readChunk();if(n.id!=="MThd"||n.length!==6)throw"Bad .mid file - header not found";r=new e(n.data),t={formatType:r.readInt16(),trackCount:r.readInt16(),ticksPerBeat:r.readInt16()};if(t.ticksPerBeat&32768)throw"Expressing time division in SMTPE frames is not supported yet";return t},t}(),u=function(){function t(e,t){this.midi_stream=e,this.header=t}return t.prototype.read=function(){var t,n,r,i,s,o,u,a,f;o=[];for(t=a=0,f=this.header.trackCount-1;0<=f?a<=f:a>=f;t=0<=f?++a:--a){n=o[t]=[],r=this.midi_stream.readChunk(),i=r.id,u=i!=="MTrk";if(u)throw"Unexpected chunk. Expected MTrk, got "+i+".";s=new e(r.data);while(!s.eof())n.push(this.readNext(s))}return o},t.prototype.readNext=function(e){var t,n,i,s;return t=new Event(e),s=e.readVarInt(),n=e.readInt8(),r=this.getEventParserByType(n),i=new r,i.read(e,s,n)},t.prototype.getEventParserByType=function(e){return(e&240)!==240?n:e===255?a:f},t}(),o=function(){function t(t){var n,r,s,o,a;s=new e(t),r=new i(s),n=r.read(),o=new u(s,n),a=o.read(),this.header=n,this.tracks=a}return t}()}),r("lib/writer",[],function(){var e;return e=function(){function e(){}return e}()}),r("main",["./lib/parser","./lib/writer","./lib/events"],function(e,t,n){var r;return r=r||window,r.MIDI=function(){function r(t,n){var r;typeof t=="string"&&(r=new e(t),t=r.header,n=r.tracks),this.header=t,this.tracks=n}return r.Writer=t,r.Parser=e,r.Events=n,r.prototype.encode=function(){return MIDI.encode(this)},r}()}),n(["main"],null,null,!0)})(this);